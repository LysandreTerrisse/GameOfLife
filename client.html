<!DOCTYPE html>
<html lang="fr">
<head>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="./fonctions_de_jeu.js" type="text/javascript" language="javascript"></script>
    <script>console.log(__dirname);</script>
    <script src="./fonctions_de_dessin.js"></script>
    <script src="./fonctions_interface.js"></script>
    <script>
    //var {genererTerrain, genererEntites, tick} = require("./fonctions_de_jeu");
    //var {enleverInputsCreationPartie, enleverInputsDeConnexion} = require("./fonctions_de_dessin");
    var socket = io();
    
    var liste_terrain = [];
    var liste_entites = [];
    var identifiant_secret = 0;
    
    
    socket.on("infos", (infos) => { // Quand on reçoit les infos du serveur
        //S'il y a au moins un joueur
        if(infos.liste_joueurs.length != 0) {
            //On modifie l'interface
            enleverInputsCreationPartie(); // On enlève les éléments spécifiques au premier joueur
            document.getElementById("paragraphe_liste_joueurs").innerHTML = infos.liste_joueurs.join(" "); // On affiche la liste des joueurs
            
            //Si l'on n'avait pas encore généré puis affiché le terrain, on le fait
            if(liste_terrain.length==0) {
                liste_terrain = genererTerrain(infos.nb_joueurs_max, infos.nb_lignes, infos.nb_colonnes);
                liste_entites = genererEntites(infos.nb_joueurs_max, infos.nb_lignes, infos.nb_colonnes)
                preparerTablier(10, 30)
            }
            
            // Si l'on a le bon nombre de joueurs
            if(infos.liste_joueurs.length == infos.nb_joueurs_max) {
                tick(liste_entites, liste_terrain, infos.nb_iterations_max)// On commence la partie en répétant tick(liste_terrain, liste_entites, nb_joueurs, nb_iterations_max) toutes les 1000ms
            }
        }
    });
    
    socket.emit('obtenir_infos'); // On demande les infos au serveur
    
    socket.on("identifiant_secret", (identifiant_secret_obtenu) => { // Quand on reçoit l'identifiant secret
        identifiant_secret = identifiant_secret_obtenu; // On le stocke
    });
    
    /* S'exécute quand on appuie sur le bouton "Jouer" */
    function demanderJoindrePartie() {
        // On envoie une requête au serveur
        let [nom_joueur, nb_iterations, nb_joueurs, nb_lignes, nb_colonnes] = extraireDepuisInterface();
        socket.emit('ajouter_joueur', nom_joueur, nb_joueurs, nb_iterations, nb_lignes, nb_colonnes);
        
        // On enlève les inputs de connexion
        enleverInputsDeConnexion();
    }
    
    /*
    
    Il ne reste plus qu'à :
    - Faire choisir le nombre de créatures par joueur au premier joueur
    - Faire des entités avec des sexes différents
    - Empêcher les entités d'entrer dans les tanière adverses
    - Faire en sorte que les entités puissent se reproduire dans la tanière
    
    - Faire en sorte que les entités ne peuvent pas se traverser sauf dans la tanière (on peut faire ça avec un algorithme efficace en faisant une liste_positions_prises)
    - Programmer une fonction random(seed)
    - Implémenter le système de pouvoir pousser les autres entités
    - Faire un algorithme de plus court chemin
    - Implémenter le paramètre "vision à distance"
    - Implémenter un algorithme de choix
    
    - Faire des entités non binaires
    */
    </script>
</head>
<body>
    <header>
        <div id="menu_connexion">
            <h3>Connexion</h3>
            Nom du joueur : <input type="text" id="champ_nom_joueur" /> </br>
            Liste des joueurs : <a id="paragraphe_liste_joueurs"></a> </br>
        </div>
        <div id="menu_creation_partie">
            <h3>Création d'une partie</h3>
            Nombre de joueurs : <input type="number" id="champ_nb_joueurs" /></br>
            Nombre d'itérations : <input type="number" id="champ_nb_iterations" /></br>
            Nombre de lignes : <input type="number" id="champ_nb_lignes" /></br>
            Nombre de colonnes : <input type="number" id="champ_nb_colonnes" /></br>
        </div>
        <div id="menu_partie">
            Nom du joueur : <a id="paragraphe_nom_joueur"></a>
            Liste des joueurs : <a id="paragraphe_liste_joueurs"></a> </br>
        </div>
        
        <input type="button" onclick="demanderJoindrePartie()" value="Jouer" id="bouton_jouer"/>
    </header>
    
    

    <div id="tablier"></div>
    
</body>
</html>
